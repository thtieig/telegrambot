#!/bin/bash

# Place this file in /usr/local/bin/telegrambot_start
# make sure is chmod +x
# Update "full_path_where_script_is_stored" with the actual path before copying/executing

# --- config ---
BOT_HOME="/full_path_where_script_is_stored/telegrambot"
VENV_PYTHON="$BOT_HOME/telegram_bot/bin/python"
BOT_SCRIPT="$BOT_HOME/telegrambot.py"
LOGFILE="/var/log/telegrambot_full.log"

# kill existing
pkill -f -9 "[p]ython.*telegrambot.py" 2>/dev/null

# go to bot home (so relative paths work)
cd "$BOT_HOME" || {
  echo "Failed to cd to $BOT_HOME" >> "$LOGFILE"
  exit 1
}

# start with unbuffered mode, capture all output
nohup "$VENV_PYTHON" -u "$BOT_SCRIPT" >> "$LOGFILE" 2>&1 &

echo "Started bot: $(date)" >> "$LOGFILE"

